# **资金费率**

------

交割合约在交割日，合约市场价格会回归到指数价格，永续合约没有到期或交割，需要通过“资金费用机制”来让合约价格锚定现货价格。

**资金费的收取**

永续合约每8小时为一期，每期结束时进行结算，每天整点结算，每天结算3次，分别是00:00、08:00、16:00。

只有在结算时持有仓位的用户，才需要收取或支付资金费；如果在结算前已经平仓，则不需要收取或支付资金费用。

结算时，用户应当收取还是支付资金费用，由本期的资金费率以及该用户的持仓情况决定。当资金费率为正值时，多仓将支付资金费用，空仓将收取资金费用；当资金费率为负值时，多仓将收取资金费用，空仓将支付资金费用。

资金费用完全在用户之间进行结算，平台不会从中收取任何费用。

**资金费用计算:**
$$
\begin{align*}
&资金费用 =仓位价值\times资金费率
\\
\\
&仓位价值=仓位张数\times面值\times标记价格
\end{align*}
$$
**资金费率的计算**

资金费率旨在确保永续合约的交易价格紧跟标的参考价格。每一期的资金费率，由上一期的数据进行计算而得，在本期开始时已经确定，期内不会改变，并应用于本期结束时的资金费用结算。本期还会每分钟计算一次下一期的预测资金费率，并将本期最后一次计算的预测资金费率，作为下一期的资金费率。

如08:00-16:00这一期的资金费率，是通过上一期00:00-08:00的数据计算而得，在08:00的时候已经确定，在16:00进行结算时使用。同时，08:00-16:00这段时间内，每分钟会计算一个预测资金费率，预测的是16:00-次日00:00这一期的资金费率，并将最后一次计算的预测资金费率，作为16:00-次日00:00这一期的资金费率。

资金费率由综合利率和溢价两部分组成。

1. 综合利率

   1. 永续合约都由两种币组成：标的币种和计价币种。如：BTCUSDT永续合约，标的币种是BTC，计价币种是USDT。

   2. 标的币种利率：标的币种在市场上的日借贷利率。如BTCUSDT合约的标的币种为BTC，则标的币种利率即为BTC的日借贷利率。

   3. 计价币种利率：计价币种在市场上的日借贷利率。如BTCUSDT合约的计价币种为USDT，则计价币种利率即为USDT的日借贷利率。
      $$
      综合利率 =\frac{计价币种利率 - 标的币种利率}{资金费率结算频率}
      $$
      

   4. 目前，所有永续合约的计价币种利率均为0.06%，标的币种利率均为0.03%，资金费率结算频率为3次（每日3次结算）。因此，当前所有永续合约的综合利率，均为0.01%。

2. 溢价：

   永续合约，相对其合理价格，可能会有溢价或者折价。我们通过溢价指数，来衡量合约的溢价程度，并将其加入资金费率的计算。溢价程度越高，则资金费率越大，空方越有动力做空；溢价程度越低，则资金费率越小，多方越有动力做多。通过提高或降低资金费率，促使合约价格回归相对合理的水平。

   1. 资金费率基差率  反映了由本期资金费用产生的基差。  
      $$
      资金费率基差率=本期资金费率\times\frac{当前时间距离本期结算的时间间隔}{结算周期}
      $$
      

      如本期的BTC永续合约资金费率为0.01%，当前时间为8:30，本期结算时间为16:00，即距离结算还有7小时30分钟，结算周期为8小时（每8小时结算一次），即：
      $$
      资金费率基差率 =0.01\%\times\frac{450}{480}=0.009375\%
      $$
      

   2. 合理价格 合理价格为基于当前现货的指数价格，以及当前的资金费率基差率，计算出来的永续合约相对合理的参考价格。 
      $$
      合理价格=指数价格\times(1+资金费率基差率)
      $$
       如当前BTC指数价格为10000 USDT，BTC永续合约资金费率基差率为0.005%，则当前BTC永续合约合理价格 = 10000 * ( 1 + 0.005% ) = 10000.5 USDT。

   3. 深度加权买/卖价格 深度加权买价，指根据当前盘口挂单情况，从买盘第一档开始，累计挂单量达到N个USDT的合约平均买单挂单价格。


深度加权卖价，指根据当前盘口挂单情况，从卖盘第一档开始，累计挂单量达到N个USDT的合约平均卖单挂单价格。

其中，N的取值范围：8000USDT，即:
$$
\sum(挂单价格\times挂单数量 )=8000USDT
$$

1. 溢价指数，反映了当前由资金费率基差率，以及深度加权买/卖价格相对于合理价格的偏差，共同作用下，产生的溢价情况。 
   $$
   溢价指数=\frac{[\max(0,深度加权买价-合理价格) - \max(0,合理价格-深度加权卖价)]}{指数价格}+资金费率基差率
   $$
    由公式可见: 

    1. 当深度加权卖价 ≥ 合理价格 ≥ 深度加权买价时：
       $$
       溢价指数 = 资金费率基差率
       $$

    2. 当深度加权卖价 > 深度加权买价 > 合理价格时：
       $$
       溢价指数 = \frac{深度加权买价\quad–\quad合理价格}{指数价格}+资金费率基差率
       $$

    3.  当合理价格 > 深度加权卖价 > 深度加权买价时（溢价指数每分钟计算一次）：
       $$
       溢价指数 = \frac{深度加权卖价\quad–\quad合理价格}{指数价格}+资金费率基差率
       $$

2. 平均溢价指数：当前的平均溢价指数，为最近1小时内所有本期的溢价指数的算术平均数。 如8:00-9:00这一期内，8:30的平均溢价指数为7:30-8:30所有溢价指数的算术平均值；9:00的平均溢价指数为8:00-9:00所有溢价指数的算术平均值。 平均溢价指数，每分钟计算一次。

预测下期资金费率，由综合利率和平均溢价指数，共同决定，公式如下：
$$
clamp1=clamp（综合利率 – 平均溢价指数，溢价偏离上限，溢价偏离下限）
\\
\\
预测下期资金费率=clamp(平均溢价指数 +clamp1，资金费率上限，资金费率下限）
$$
其中，clamp为区间限定函数，当目标值超过上下限时，只会取边界值。如clamp(a, max, min)，当a > max时，结果为max；当a < min时，结果为min；当max ≥ a ≥ min时，结果为a。

综合利率 – 平均溢价指数，由溢价偏离上限和溢价偏离下限进行限制，介于二者之间；最终预测下期资金费率，由资金费率上限和资金费率下限进行限制，介于二者之间。具体参数如下：

| 溢价价偏离上限 | 溢价偏离下限 | 资金费率上限 | 资金费率下限 |
| :------------: | :----------: | :----------: | :----------: |
|     0.05%      |    -0.05%    |    0.375%    |   -0.375%    |







